<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Advanced medical prescription analysis and diagnosis platform powered by AI">
    <meta name="theme-color" content="#4a90e2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>CuraSense Diagnosis Dashboard | AI-Powered Medical Analysis</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- CSS Libraries -->
    <link rel="stylesheet" href="/frontend/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    
    <!-- JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
</head>
<body>
    <!-- Particles Background -->
    <div id="particles-js"></div>
    
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="logo">
                <h2>CuraSense <span class="subtitle">DIAGNOSIS</span></h2>
            </div>
            <nav class="nav-menu">
                <a href="#home" class="nav-item active" data-section="home">
                    <span class="icon">üè†</span> Home
                </a>
                <a href="#analyze" class="nav-item" data-section="analyze">
                    <span class="icon">üî¨</span> Analyze
                </a>
                <a href="#compare" class="nav-item" data-section="compare">
                    <span class="icon">‚öñÔ∏è</span> Compare
                </a>
                <a href="#safety" class="nav-item" data-section="safety">
                    <span class="icon">üõ°Ô∏è</span> Safety
                </a>
                <a href="#reports" class="nav-item" data-section="reports">
                    <span class="icon">üìä</span> Reports
                </a>
                <a href="#xray" class="nav-item" data-section="xray">
                    <span class="icon">ü©ª</span> X-Ray Analysis
                </a>
            </nav>
            
            <div class="quick-actions">
                <h4>Quick Actions</h4>
                <button class="action-btn" onclick="showUploadModal()">
                    <span class="icon">üì§</span> Upload Prescription
                </button>
                <button class="action-btn" onclick="showManualEntryModal()">
                    <span class="icon">‚úçÔ∏è</span> Enter Manually
                </button>
                <button class="action-btn" onclick="showCompareModal()">
                    <span class="icon">üîç</span> Compare Medicines
                </button>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <header class="top-bar">
                <div class="search-bar">
                    <input type="text" placeholder="Search medicines, diseases, interactions" id="searchInput">
                    <button onclick="searchContent()">üîç</button>
                </div>
                <div class="user-actions">
                    <button class="theme-toggle" onclick="toggleDarkMode()" title="Toggle Dark Mode">
                        <svg class="theme-icon sun-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>
                        <svg class="theme-icon moon-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                    </button>
                    <button class="btn-secondary plan-badge" data-aos="fade-left" data-aos-delay="100">
                        <span class="badge-icon">üë§</span> Free Plan
                    </button>
                    <div class="user-avatar" data-aos="zoom-in" data-aos-delay="200">
                        <img src="https://ui-avatars.com/api/?name=User+Profile&background=4a90e2&color=fff&size=128&bold=true" alt="User Profile">
                        <div class="status-dot"></div>
                    </div>
                </div>
            </header>

            <!-- Home Dashboard Section -->
            <section id="section-home" class="content-section active">
                <div class="dashboard-header" data-aos="fade-down" data-aos-duration="800">
                    <div class="header-icon">üè•</div>
                    <h1 class="gradient-text-animated">Home Dashboard</h1>
                    <p class="subtitle-text">Start by uploading a prescription, entering medicine details, or comparing brands.</p>
                </div>

                <div class="action-cards">
                    <div class="card action-card card-3d" onclick="showUploadModal()" data-aos="fade-up" data-aos-delay="100">
                        <div class="card-shine"></div>
                        <div class="card-icon">üì∏</div>
                        <h3>Upload Prescription Image</h3>
                        <p>Drag & drop a photo of your prescription or browse files</p>
                        <button class="btn-primary pulse">
                            <span class="btn-icon">üì§</span> Upload Image
                        </button>
                    </div>

                    <div class="card action-card card-3d" onclick="showManualEntryModal()" data-aos="fade-up" data-aos-delay="200">
                        <div class="card-shine"></div>
                        <div class="card-icon">‚úçÔ∏è</div>
                        <h3>Enter Medicine/Disease Manually</h3>
                        <p>Type the medicine name and details for analysis</p>
                        <button class="btn-primary pulse">
                            <span class="btn-icon">‚å®Ô∏è</span> Enter Manually
                        </button>
                    </div>

                    <div class="card action-card card-3d" onclick="showCompareModal()" data-aos="fade-up" data-aos-delay="300">
                        <div class="card-shine"></div>
                        <div class="card-icon">‚öñÔ∏è</div>
                        <h3>Compare Medicines</h3>
                        <p>Check ingredients, strength, and compare different brands</p>
                        <button class="btn-primary pulse">
                            <span class="btn-icon">üîç</span> Start Comparison
                        </button>
                    </div>
                </div>

                <div class="upload-section card">
                    <h2>Upload / Enter Details</h2>
                    <div class="upload-area" id="dropZone">
                        <div class="upload-placeholder">
                            <span class="upload-icon">üìÑ</span>
                            <p>Drag & drop prescription image or click to browse</p>
                        </div>
                        <input type="file" id="fileInput" accept="image/*,application/pdf" hidden>
                    </div>
                    <div class="manual-entry">
                        <textarea id="manualEntry" placeholder="Enter medicine/disease details
e.g., Paracetamol 500mg twice daily for 5 days" rows="4"></textarea>
                        <div class="btn-group">
                            <button class="btn-primary" onclick="analyzeMedicine()">Analyze Medicine</button>
                            <button class="btn-secondary" onclick="smartParse()">Smart Parse</button>
                        </div>
                    </div>
                </div>

                <!-- NER & Validation Results -->
                <div class="card" id="nerResults" style="display: none;">
                    <h2>NER & Validation Results</h2>
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>Medicine Name</th>
                                <th>Dosage</th>
                                <th>Frequency</th>
                                <th>Duration</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="nerTableBody">
                            <!-- Dynamic content -->
                        </tbody>
                    </table>
                </div>

                <!-- Recent Reports -->
                <div class="card">
                    <h2>Recent Reports</h2>
                    <div class="reports-list" id="recentReports">
                        <p class="no-data">No recent reports. Upload a prescription to get started.</p>
                    </div>
                </div>
            </section>

            <!-- Analyze Section -->
            <section id="section-analyze" class="content-section">
                <div class="dashboard-header" data-aos="fade-down">
                    <div class="header-icon">üî¨</div>
                    <h1 class="gradient-text-animated">Medicine Analysis</h1>
                    <p class="subtitle-text">Comprehensive medication analysis and safety assessment</p>
                </div>
                <div class="analysis-container">
                    <div class="card">
                        <h2>Patient Information</h2>
                        <div class="form-group">
                            <label>Name:</label>
                            <input type="text" id="patientName" placeholder="Patient Name">
                        </div>
                        <div class="form-group">
                            <label>Age:</label>
                            <input type="number" id="patientAge" placeholder="Age">
                        </div>
                        <div class="form-group">
                            <label>Medical History:</label>
                            <textarea id="medicalHistory" placeholder="Enter medical history" rows="3"></textarea>
                        </div>
                    </div>

                    <div class="card" id="analysisResults">
                        <h2>Analysis Results</h2>
                        <div class="analysis-content">
                            <p class="no-data">Enter medicine details and click analyze to see results.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Compare Section -->
            <section id="section-compare" class="content-section">
                <h1>Alternative Medicine Comparison</h1>
                <div class="comparison-container">
                    <div class="compare-upload">
                        <div class="upload-box">
                            <h3>Upload Original Medicine Image</h3>
                            <input type="file" id="originalMedicine" accept="image/*">
                        </div>
                        <div class="upload-box">
                            <h3>Upload Alternative Brand Image</h3>
                            <input type="file" id="alternativeMedicine" accept="image/*">
                        </div>
                    </div>

                    <div class="comparison-table card">
                        <table class="compare-table">
                            <thead>
                                <tr>
                                    <th>Check</th>
                                    <th>Original</th>
                                    <th>Alternative</th>
                                    <th>Recommendation</th>
                                </tr>
                            </thead>
                            <tbody id="compareTableBody">
                                <tr>
                                    <td>Ingredient Match</td>
                                    <td><span class="status-indicator match">‚óè Match</span></td>
                                    <td><span class="status-indicator match">‚óè Match</span></td>
                                    <td>Substitution acceptable</td>
                                </tr>
                                <tr>
                                    <td>Strength/Dosage</td>
                                    <td>500 mg</td>
                                    <td>650 mg</td>
                                    <td>‚ö†Ô∏è Adjust dosage; consult doctor</td>
                                </tr>
                                <tr>
                                    <td>Safety & Substitution</td>
                                    <td>Safe</td>
                                    <td>Caution</td>
                                    <td>Use only if needed</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Safety Section -->
            <section id="section-safety" class="content-section">
                <h1>Safety & Best Practices</h1>
                <div class="safety-grid">
                    <div class="card safety-card">
                        <h2>Safety Report</h2>
                        <div class="safety-item">
                            <span class="warning-icon">‚ö†Ô∏è</span>
                            <div>
                                <h4>History of gastric ulcers, Avoid NSAIDs like Ibuprofen</h4>
                                <span class="severity high">üî¥ High Risk</span>
                            </div>
                        </div>
                        <div class="safety-item">
                            <span class="warning-icon">‚ö†Ô∏è</span>
                            <div>
                                <h4>Interactions: Ibuprofen may interact with: Warfarin - Monitor INR</h4>
                                <span class="severity medium">üü† Medium</span>
                            </div>
                        </div>
                        <div class="safety-item success">
                            <span class="check-icon">‚úì</span>
                            <div>
                                <h4>Paracetamol within max 3g/day is generally safe</h4>
                                <span class="severity safe">üü¢ Safe</span>
                            </div>
                        </div>
                    </div>

                    <div class="card best-practices-card">
                        <h2>Best Practices</h2>
                        <div class="practices-content">
                            <h3>Recommended dosages</h3>
                            <ul>
                                <li><strong>Paracetamol:</strong> 500 mg every 6-8 hours with food</li>
                                <li><strong>Ibuprofen:</strong> 200-400 mg every 6-8 hours with food</li>
                            </ul>

                            <h3>Safer alternatives</h3>
                            <ul>
                                <li>Consider acetaminophen for pain if gastric ulcers history</li>
                                <li>Use lowest effective dose</li>
                                <li>Consider NSAIDs as local option</li>
                            </ul>

                            <div class="external-links">
                                <a href="#" class="link-btn">WHO Guidelines</a>
                                <a href="#" class="link-btn">NICE Guidance</a>
                                <a href="#" class="link-btn">FDA Resources</a>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Reports Section -->
            <section id="section-reports" class="content-section">
                <h1>Final Report</h1>
                <div class="report-container card">
                    <div class="report-header">
                        <div class="patient-info">
                            <span class="icon">üë§</span>
                            <button onclick="addPatientInfo()">Add Info</button>
                        </div>
                    </div>
                    <div class="report-content" id="finalReportContent">
                        <p class="placeholder">No analysis completed yet. Analyze a prescription to generate a report.</p>
                    </div>
                    <div class="report-actions">
                        <button class="btn-primary" onclick="downloadReport()">
                            <span>üì•</span> Download Report
                        </button>
                        <button class="btn-secondary" onclick="shareWithDoctor()">
                            <span>üì§</span> Share with Doctor
                        </button>
                    </div>
                </div>
            </section>

            <!-- X-Ray Analysis Section -->
            <section id="section-xray" class="content-section">
                <div class="dashboard-header" data-aos="fade-down">
                    <div class="header-icon">ü©ª</div>
                    <h1 class="gradient-text-animated">Medical Image Analysis</h1>
                    <p class="subtitle-text">Upload X-ray or medical images for AI-powered analysis and diagnosis</p>
                </div>
                
                <div class="card">
                    <h3>üì§ Step 1: Upload Medical Image</h3>
                    <div class="xray-upload-area" id="xrayDropZone">
                        <div class="upload-placeholder" id="xrayPlaceholder">
                            <span class="upload-icon">ü©ª</span>
                            <p>Drag & drop X-ray/medical image or click to browse</p>
                            <p class="file-types">Supported: JPG, PNG, DICOM</p>
                        </div>
                        <input type="file" id="xrayFileInput" accept="image/*" hidden>
                        <div id="xrayPreview" class="image-preview" style="display: none;">
                            <img id="xrayPreviewImage" alt="X-ray preview">
                            <button class="btn-secondary small-btn" onclick="removeXrayImage()">‚úï Remove</button>
                        </div>
                    </div>
                    <button class="btn-primary" id="uploadXrayBtn" onclick="uploadAndAnalyzeXray()" disabled>
                        <span>üîç</span> Upload & Generate Report
                    </button>
                    <div id="uploadStatus" class="status-message"></div>
                </div>

                <div class="card" id="xrayReportCard" style="display: none;">
                    <h3>üìã AI-Generated X-Ray Report</h3>
                    <div class="loading-indicator" id="xrayLoading">
                        <div class="spinner"></div>
                        <p>Analyzing medical image and generating report...</p>
                    </div>
                    <div id="xrayReportResult" class="analysis-result" style="display: none;"></div>
                    <div class="report-actions" id="xrayReportActions" style="display: none;">
                        <button class="btn-primary" onclick="downloadXrayReport()">
                            <span>üì•</span> Download Report
                        </button>
                        <button class="btn-secondary" onclick="showQuestionSection()">
                            <span>‚ùì</span> Ask Questions About Report
                        </button>
                    </div>
                </div>

                <div class="card" id="xrayQueryCard" style="display: none;">
                    <h3>üí¨ Ask Questions About The Report</h3>
                    <div class="chat-section">
                        <div id="xrayConversation" class="conversation-area"></div>
                        <div class="query-input-section">
                            <input type="text" id="xrayQuery" placeholder="Ask about findings, severity, recommendations..." class="form-control" onkeypress="if(event.key==='Enter') askXrayQuestion()">
                            <button class="btn-primary" onclick="askXrayQuestion()">
                                <span>‚û§</span> Ask
                            </button>
                        </div>
                    </div>
                </div>

                <div class="info-box">
                    <h4>‚ÑπÔ∏è How It Works</h4>
                    <ul>
                        <li><strong>Step 1:</strong> Upload your X-ray, CT scan, or MRI image</li>
                        <li><strong>Step 2:</strong> AI automatically analyzes the image and generates a detailed report</li>
                        <li><strong>Step 3:</strong> Ask specific questions about findings, severity, or treatment recommendations</li>
                        <li>‚ö†Ô∏è <strong>Important:</strong> This is an AI assistant tool for educational purposes. Always consult a qualified healthcare provider for medical decisions.</li>
                    </ul>
                </div>
            </section>
        </main>

        <!-- Assistant Chatbot Sidebar -->
        <aside class="assistant-sidebar" id="assistantSidebar">
            <div class="assistant-header">
                <h3>Assistant</h3>
                <button class="close-btn" onclick="toggleAssistant()">‚úï</button>
            </div>
            <div class="assistant-content">
                <h4>Chatbot Assistant</h4>
                <div class="chat-messages" id="chatMessages">
                    <div class="chat-message bot">
                        <p>Hello! Upload a prescription or ask about a medicine.</p>
                    </div>
                </div>
                <div class="chat-input-container">
                    <input type="text" id="chatInput" placeholder="Type your question..." 
                           onkeypress="if(event.key==='Enter') sendMessage()">
                    <button class="send-btn" onclick="sendMessage()">Send</button>
                </div>
            </div>
        </aside>

        <!-- Toggle Assistant Button -->
        <button class="assistant-toggle" onclick="toggleAssistant()">
            üí¨
        </button>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="spinner"></div>
        <p>Processing your request...</p>
    </div>

    <!-- Share with Doctor Modal -->
    <div class="modal-overlay" id="shareModal" style="display: none;">
        <div class="modal-content card">
            <button class="close-btn" onclick="closeShareModal()">√ó</button>
            <h2>üì§ Share Report with Doctor</h2>
            <p class="subtitle-text">Choose how you'd like to share this medical report</p>
            
            <div class="share-options">
                <div class="share-option-card" onclick="shareViaEmail()">
                    <div class="option-icon">üìß</div>
                    <h3>Email Report</h3>
                    <p>Send via email to your doctor</p>
                </div>
                
                <div class="share-option-card" onclick="copyReportLink()">
                    <div class="option-icon">üîó</div>
                    <h3>Copy Link</h3>
                    <p>Share a secure link</p>
                </div>
                
                <div class="share-option-card" onclick="downloadReportPDF()">
                    <div class="option-icon">üìÑ</div>
                    <h3>Download PDF</h3>
                    <p>Save as PDF document</p>
                </div>
                
                <div class="share-option-card" onclick="printReport()">
                    <div class="option-icon">üñ®Ô∏è</div>
                    <h3>Print Report</h3>
                    <p>Print directly</p>
                </div>
            </div>
            
            <div class="email-form" id="emailForm" style="display: none;">
                <h3>üìß Send via Email</h3>
                <div class="form-group">
                    <label>Doctor's Email:</label>
                    <input type="email" id="doctorEmail" placeholder="doctor@hospital.com" required>
                </div>
                <div class="form-group">
                    <label>Your Email:</label>
                    <input type="email" id="patientEmail" placeholder="your@email.com" required>
                </div>
                <div class="form-group">
                    <label>Message (Optional):</label>
                    <textarea id="emailMessage" rows="3" placeholder="Add a message to your doctor..."></textarea>
                </div>
                <div class="btn-group">
                    <button class="btn-primary" onclick="sendEmailReport()">Send Email</button>
                    <button class="btn-secondary" onclick="backToShareOptions()">Back</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/frontend/dashboard.js"></script><script src="/frontend/init-libraries.js"></script>
</body>
</html>
